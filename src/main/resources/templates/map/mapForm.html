<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">
<head>
  <title>주변 맛집</title>
  <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=1w46shh6nb"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
  <meta charset="utf-8">
</head>
<!-- 사용자 CSS 추가 -->




<div layout:fragment="content">

  <!--지도 호출 구문-->
  <div id="map" style="width:100%;height:1000px;"></div>

  <script type="text/javascript">

    $(function() {

      initMap();

    });


    function initMap() {

      var areaArr = new Array();  // 지역을 담는 배열 ( 지역명/위도경도 )
      areaArr.push(
              /*지역구 이름*/			/*위도*/					/*경도*/
              {location : '강서구' , lat : '35.2122179' , lng : '128.98045'},  // 강서구 중심좌표
              {location : '금정구' , lat : '35.243068' , lng : '129.0921'},  // 금정구 중심좌표
              {location : '남구' , lat : '35.136577' , lng : '129.084163'},  // 남구 중심좌표
              {location : '동구' , lat : '35.1292746' , lng : '129.0453253'},  // 동구 중심좌표
              {location : '동래구' , lat : '35.1964382' , lng : '129.0938569'},  // 동래구 중심좌표
              {location : '부산진구' , lat : '35.162913' , lng : '129.053157'},  // 부산진구 중심좌표
              {location : '북구' , lat : '35.197185' , lng : '128.990438' },  // 북구 중심좌표
              {location : '사상구' , lat : '35.152624' , lng : '128.99125'},  // 사상구 중심좌표
              {location : '사하구' , lat : '35.104585' , lng : '128.974817'},  // 사하구 중심좌표
              {location : '서구' , lat : '35.0979321' , lng : '129.0244125'},  // 서구 중심좌표
              {location : '수영구' , lat : '35.145694' , lng : '129.113186'},  // 수영구 중심좌표
              {location : '연제구' , lat : '35.176242' , lng : '129.079764'},  // 연제구 중심좌표
              {location : '영도구' , lat : '35.091199' , lng : '129.067875'},  // 영도구 중심좌표
              {location : '중구' , lat : '35.106214' , lng : '129.032352'},  // 중구 중심좌표
              {location : '해운대구' , lat : '35.163177' , lng : '129.163634'},  // 해운대구 중심좌표
              {location : '기장군' , lat : '35.244498' , lng : '129.222312'},  // 기장군 중심좌표
      );



      let markers = new Array(); // 마커 정보를 담는 배열
      let infoWindows = new Array(); // 정보창을 담는 배열

      var map = new naver.maps.Map('map', {
        center: new naver.maps.LatLng(35.1797865, 129.0750194), //지도 시작 지점
        zoom: 13
      });




      for (var i = 0; i < areaArr.length; i++) {
        // 지역을 담은 배열의 길이만큼 for문으로 마커와 정보창을 채워주자 !

        var marker = new naver.maps.Marker({
          map: map,
          title: areaArr[i].location, // 지역구 이름
          position: new naver.maps.LatLng(areaArr[i].lat , areaArr[i].lng) // 지역구의 위도 경도 넣기
        });

        /* 정보창 */
        var infoWindow = new naver.maps.InfoWindow({
          content: '<div style="width:200px;text-align:center;padding:10px;"><b>' + areaArr[i].location + '</b><br> - 네이버 지도 - </div>'
        }); // 클릭했을 때 띄워줄 정보 HTML 작성

        markers.push(marker); // 생성한 마커를 배열에 담는다.
        infoWindows.push(infoWindow); // 생성한 정보창을 배열에 담는다.
      }


      function getClickHandler(seq) {

        return function(e) {  // 마커를 클릭하는 부분
          var marker = markers[seq], // 클릭한 마커의 시퀀스로 찾는다.
                  infoWindow = infoWindows[seq]; // 클릭한 마커의 시퀀스로 찾는다

          if (infoWindow.getMap()) {
            infoWindow.close();
          } else {
            infoWindow.open(map, marker); // 표출
          }
        }
      }

      for (var i=0, ii=markers.length; i<ii; i++) {
        console.log(markers[i] , getClickHandler(i));
        naver.maps.Event.addListener(markers[i], 'click', getClickHandler(i)); // 클릭한 마커 핸들러
      }
    }

  </script>


  <div class="container">
    <tr th:each="restaurant : ${restaurantList}">
      <td th:text="${restaurant.res_district}"></td>
      <td th:text="${restaurant.res_lat}"></td>
      <td th:text="${restaurant.res_lng}"></td>
    </tr>

  </div>
</div>